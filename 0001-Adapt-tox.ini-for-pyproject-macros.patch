From 6c32c6b130b6902c0b263444cb7968fec0e6a1e2 Mon Sep 17 00:00:00 2001
From: Alfredo Moralejo <amoralej@redhat.com>
Date: Thu, 13 Jul 2023 12:47:22 +0200
Subject: [PATCH] Adapt tox.ini for pyproject macros

---
 tox.ini | 16 ----------------
 1 file changed, 16 deletions(-)

diff --git a/tox.ini b/tox.ini
index 5579cf6..666674a 100644
--- a/tox.ini
+++ b/tox.ini
@@ -2,9 +2,6 @@
 minversion = 3.18.0
 # Tox 4 gives errors as if the entry_points of setup.cfg were not available
 # during tests.
-requires =
-  virtualenv>=20.4.2
-  tox<4
 # python runtimes: https://governance.openstack.org/tc/reference/project-testing-interface.html#tested-runtimes
 envlist = py3,pep8
 skipsdist = True
@@ -36,8 +33,6 @@ usedevelop=True
 # NOTE: Functional tests may fail if host is missing bindeps from deps projects
 deps =
     -r{toxinidir}/test-requirements.txt
-    git+https://opendev.org/openstack/os-brick
-    git+https://opendev.org/openstack/cinder
 
 commands =
     find . -ignore_readdir_race -type f -name "*.pyc" -delete
@@ -58,10 +53,8 @@ allowlist_externals =
   {toxinidir}/tools/special_install.sh
   {toxinidir}/tools/generate_uc.sh
 
-install_command = {toxinidir}/tools/special_install.sh {env:PIP_OPTIONS:} {opts} {packages}
 
 [testenv:functional]
-install_command = {[testenv:py3]install_command}
 usedevelop=True
 passenv =
   CL_FTEST_POOL_NAME
@@ -93,7 +86,6 @@ allowlist_externals =
   stestr
 
 [testenv:functional-py{38,39,310,311}]
-install_command = {[testenv:functional]install_command}
 usedevelop=True
 passenv =
   {[testenv:functional]passenv}
@@ -108,7 +100,6 @@ allowlist_externals = {[testenv:functional]allowlist_externals}
 [testenv:releasenotes]
 # Not reusing doc's env due to https://github.com/tox-dev/tox/issues/477
 # envdir = {toxworkdir}/docs
-install_command = {[testenv:docs]install_command}
 deps =
   -r{toxinidir}/doc/requirements.txt
 commands = sphinx-build -a -E -W -d releasenotes/build/doctrees -b html releasenotes/source releasenotes/build/html
@@ -116,19 +107,15 @@ commands = sphinx-build -a -E -W -d releasenotes/build/doctrees -b html releasen
 [testenv:docs]
 # yes, we want the constraint in the install_command, not deps, so that
 # https://review.opendev.org/c/openstack/glance/+/839786 does not happen
-# to us
-install_command = python -m pip install -c{env:TOX_CONSTRAINTS_FILE:https://releases.openstack.org/constraints/upper/2023.2} {opts} {packages}
 deps =
   -r{toxinidir}/doc/requirements.txt
 commands =
-  doc8 --ignore D001 --ignore-path .tox --ignore-path *.egg-info --ignore-path doc/build --ignore-path .eggs/*/EGG-INFO/*.txt -e txt -e rst
   rm -rf doc/build .autogenerated doc/source/api
   sphinx-build -W -b html doc/source doc/build/html
   rm -rf api-ref/build
 allowlist_externals = rm
 
 [testenv:pdf-docs]
-install_command = {[testenv:docs]install_command}
 deps =
   {[testenv:docs]deps}
 commands =
@@ -154,7 +141,6 @@ commands = bindep {posargs}
 usedevelop = False
 
 [testenv:pylint]
-install_command = {[testenv:docs]install_command}
 deps = -r{toxinidir}/test-requirements.txt
        -r{toxinidir}/requirements.txt
        pylint==2.1.1
@@ -181,7 +167,6 @@ per-file-ignores =
     cinderlib/cmd/cinder_to_yaml.py:E402
 
 [testenv:pep8]
-install_command = {[testenv:docs]install_command}
 commands=flake8 {posargs} .
 deps=
     -r{toxinidir}/test-requirements.txt
@@ -189,7 +174,6 @@ deps=
 [testenv:fast8]
 # Not reusing Flake8's env due to https://github.com/tox-dev/tox/issues/477
 # envdir = {toxworkdir}/flake8
-install_command = {[testenv:docs]install_command}
 commands={toxinidir}/tools/fast8.sh
 passenv =
   FAST8_NUM_COMMITS
-- 
2.39.3


